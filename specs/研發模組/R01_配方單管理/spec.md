# Feature Specification: 配方管理介面

**Feature Branch**: `001-recipe-management-ui`
**Created**: 2025-11-06
**Status**: Draft
**Input**: User description: "配方管理介面：建立、編輯、查詢配方的使用者介面，支援版本管理和多條件篩選"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 建立新配方 (Priority: P1)

研發人員需要建立新產品配方時，能夠在配方建立表單中輸入完整的配方資訊，包含名稱、日期、版本號、來源配方編號、目的、條件、樣品數、照片、項目（名稱/百分比/克數）、注意事項、洗豆時間、洗豆水量、每包投料量、膨脹率等欄位，並提交給主管審核。

**Why this priority**: 這是配方管理的核心功能，沒有建立配方的能力，整個系統就無法運作。這是 MVP 的基礎。

**Independent Test**: 研發人員可以登入系統，填寫完整的配方表單（所有必填和選填欄位），上傳照片，輸入必要資訊後送出，系統顯示提交成功訊息。可以在配方列表中看到剛建立的配方（待審核狀態）。

**Acceptance Scenarios**:

1. **Given** 研發人員已登入系統，**When** 點擊「建立新配方」按鈕，**Then** 系統顯示配方建立表單，包含所有欄位：名稱、日期、版本號、來源配方編號、目的、條件、樣品數、照片上傳、項目清單、注意事項、洗豆時間、洗豆水量、每包投料量、膨脹率等
2. **Given** 研發人員選擇「來源配方編號」（基於舊配方），**When** 選擇特定配方，**Then** 系統自動填入該配方的相關資訊到表單中
3. **Given** 研發人員在配方表單中填寫完整資訊並上傳照片，**When** 點擊「提交審核」按鈕，**Then** 系統驗證資料完整性，儲存配方並標記為「待審核」狀態，顯示成功訊息
4. **Given** 研發人員在配方表單中填寫不完整資訊（缺少必填欄位），**When** 點擊「提交審核」按鈕，**Then** 系統標示必填欄位錯誤，阻止提交並提示使用者補充資訊
5. **Given** 配方已成功提交，**When** 研發人員查看配方列表，**Then** 系統顯示剛建立的配方及其「待審核」狀態

---

### User Story 2 - 編製新版本配方（快速建立功能） (Priority: P2)

研發人員需要根據現有配方建立新版本時，能夠選擇「編製新配方」功能，系統自動複製舊版本內容並歸檔舊版本，研發人員在此基礎上修改後提交。版本號遵循大版本（A/B/C）和小版本（A1/A2/A3）規則。

**Why this priority**: 版本管理是配方管理的重要功能，能大幅提升研發效率並確保歷史追蹤。在基本建立功能完成後，這是最有價值的增強功能。

**Independent Test**: 研發人員可以在現有配方詳情頁面點擊「編製新版本」，系統自動填入舊版本資訊並分配新版本號（例如從 A2 → A3），研發人員修改後提交，新版本建立成功且舊版本自動歸檔。

**Acceptance Scenarios**:

1. **Given** 研發人員正在查看某個配方（例如版本 A2）的詳情頁面，**When** 點擊「編製新版本」按鈕，**Then** 系統開啟新配方表單並自動填入目前版本的所有資訊，版本號自動遞增為 A3
2. **Given** 研發人員在複製的表單中修改部分內容（例如更新洗豆水量或項目比例），**When** 點擊「提交審核」，**Then** 系統建立新版本配方（A3），舊版本（A2）自動標記為「已歸檔」狀態
3. **Given** 研發人員需要建立大版本變更（重大配方調整），**When** 選擇「建立大版本」選項，**Then** 系統將版本號從 A 系列升級到 B 系列（例如 A3 → B1）
4. **Given** 新版本配方已建立，**When** 研發人員查看該配方的版本歷史，**Then** 系統顯示所有版本列表（A1, A2, A3），包含版本號、建立日期、建立人、狀態等資訊
5. **Given** 研發人員查看版本歷史，**When** 點擊任一歷史版本（例如 A1），**Then** 系統顯示該版本的完整資訊（唯讀模式）

---

### User Story 3 - 多條件查詢與篩選配方 (Priority: P3)

研發人員和主管需要快速找到特定配方時，能夠使用多個條件篩選（配方名稱、版本號、日期範圍、狀態等），系統即時顯示符合條件的配方列表。

**Why this priority**: 查詢功能提升使用者體驗，但在配方數量較少時，基本的列表瀏覽也能滿足需求。這是優化功能而非核心功能。

**Independent Test**: 使用者可以在配方列表頁面輸入篩選條件（例如：配方名稱包含「巧克力」、狀態為「已核准」、日期範圍為最近三個月），點擊「查詢」後看到符合條件的配方列表。

**Acceptance Scenarios**:

1. **Given** 使用者在配方列表頁面，**When** 在篩選區塊輸入配方名稱關鍵字（例如「布朗尼」），**Then** 系統即時顯示名稱包含該關鍵字的配方
2. **Given** 使用者選擇特定版本號篩選條件（例如 A 系列），**When** 點擊「查詢」按鈕，**Then** 系統顯示所有 A 系列版本的配方（A1, A2, A3...）
3. **Given** 使用者選擇日期範圍（2025-01-01 到 2025-03-31）和狀態（已核准）組合條件，**When** 點擊「查詢」，**Then** 系統顯示符合所有條件的配方列表
4. **Given** 使用者已套用篩選條件，**When** 點擊「清除篩選」按鈕，**Then** 系統重置所有篩選條件並顯示完整配方列表

---

### User Story 4 - 主管審核配方 (Priority: P2)

主管需要審核研發人員提交的配方時，能夠查看配方完整資訊（包含所有欄位和照片），核准或退回配方，並填寫審核意見。

**Why this priority**: 審核流程是配方管理的關鍵環節，確保配方品質和合規性。這是完整工作流程的必要組成部分。

**Independent Test**: 主管可以查看待審核配方列表，點擊配方查看所有詳細資訊（名稱、日期、目的、條件、樣品數、照片、項目清單、注意事項、洗豆時間、洗豆水量、每包投料量、膨脹率等），選擇「核准」或「退回」並填寫審核意見，配方狀態相應更新。

**Acceptance Scenarios**:

1. **Given** 主管已登入系統，**When** 進入配方列表頁面並篩選「待審核」狀態，**Then** 系統顯示所有待審核的配方列表
2. **Given** 主管點擊某個待審核配方，**When** 查看配方詳情，**Then** 系統顯示完整配方資訊（所有欄位、照片）及審核操作按鈕（核准、退回）
3. **Given** 主管點擊「核准」按鈕並填寫審核意見，**When** 確認提交，**Then** 系統將配方狀態更新為「已核准」，記錄審核人、審核時間和意見
4. **Given** 主管點擊「退回」按鈕並說明退回原因，**When** 確認提交，**Then** 系統將配方狀態更新為「已退回」，通知研發人員並顯示退回原因

---

### Edge Cases

- 當研發人員建立配方但網路連線中斷時，系統如何處理？是否需要暫存草稿功能？
- 當同一配方有多個版本同時在審核中時，如何管理衝突？
- 當照片檔案過大（超過 5MB）或格式不支援時，系統如何提示？
- 當使用者篩選條件過於複雜導致無結果時，系統如何提示？
- 當主管審核配方時，該配方被研發人員同時編輯，如何處理並發衝突？
- 配方歷史版本的保存期限是否有限制？如何處理超過保存期限的舊版本？
- 當版本號達到 A99 或 Z99 時，如何處理版本號溢位問題？

## Requirements *(mandatory)*

### Functional Requirements

#### 配方建立與編輯 - 資料結構

系統採用**配方主檔 + 版本管理**的二層式架構：
- **配方主檔 (Recipe)**：包含配方的基本識別資訊（名稱、說明、主圖）
- **版本 (Version)**：每個配方可有多個版本，每個版本包含完整的配方內容

#### 配方建立與編輯 - 表單欄位

- **FR-001**: 系統必須提供配方建立表單，採用二層式結構：

  **【配方主檔資訊】**
  - **配方名稱**（必填，文字輸入，最多 100 字元，例如：紅豆湯、糙米粥）
  - **配方說明**（選填，多行文字輸入，說明配方用途，最多 200 字元）
  - **配方主圖照片**（選填，支援 JPG/PNG 格式，單張最大 5MB，用於快速識別）

  **【版本資訊】**
  - **版本名稱**（必填，文字輸入，格式：v1, v2, v3...，系統自動編號或手動輸入）
  - **版本標籤**（必填，文字輸入，最多 50 字元，例如：傳統版、低糖版、速煮版）
  - **建立日期**（選填，日期選擇器，預設為今日）
  - **研發目的**（必填，多行文字輸入，說明此版本的研發目的，最多 200 字元）
  - **條件說明**（選填，多行文字輸入，記錄殺菌條件、客戶需求等，最多 200 字元）

  **【測量數據】**
  - **PH 值**（選填，數字輸入，支援小數點，範圍 0-14，例如：6.5）
  - **Brix 糖度**（選填，數字輸入，支援小數點，單位：°Bx，例如：15）
  - **樣品數**（選填，數字輸入，例如：10）
  - **樣品單位**（選填，下拉選單：罐/杯/袋/碗）

  **【配方項目】**（必填，動態表格，至少一項項目）
  - **項目名稱**（文字輸入，例如：紅豆、糖、水）
  - **百分比 (%)**（數字輸入，支援小數點，例如：45.5%）
  - **克數 (g)**（數字輸入，支援小數點，例如：225.5g）
  - 系統必須顯示百分比總和，建議為 100%

  **【穀物專用資訊】**（選填區塊，適用於穀物類產品）
  - **洗豆時間**（選填，數字輸入，單位：分鐘，例如：30）
  - **洗豆水量**（選填，數字輸入，單位：ml，例如：500）
  - **每包投料量**（選填，數字輸入，單位：g，例如：1000）
  - **膨脹率**（選填，數字輸入，倍數，例如：2.5）

  **【照片與備註】**
  - **上傳照片**（選填，支援 JPG/PNG 格式，單張最大 5MB，支援多張上傳）
  - **注意事項**（選填，多行文字輸入，記錄重要注意事項，最多 500 字元）

- **FR-002**: 系統必須驗證所有必填欄位，未填寫時阻止提交並在欄位旁顯示紅色錯誤提示

- **FR-003**: 系統必須在基於現有版本建立新版本時，自動填入該版本的所有資訊（研發目的、條件說明、測量數據、項目清單、穀物資訊、注意事項等）到表單中

- **FR-004**: 系統必須支援動態新增/刪除項目，每個項目包含：項目名稱（文字）、百分比（數字）、克數（數字）

- **FR-005**: 系統必須限制所有照片上傳格式為 JPG 或 PNG，檔案大小不超過 5MB，超過限制時顯示錯誤訊息

- **FR-006**: 系統必須提供照片預覽功能，使用者上傳後可立即查看縮圖

- **FR-007**: 系統必須在「配方項目」動態表格中自動計算百分比總和，如總和不等於 100% 則顯示黃色警告提示（非阻擋提交）

- **FR-008**: 系統必須在配方詳情頁面的左側顯示快速資訊卡片，包含：建立日期、樣品數量、PH值、Brix糖度

#### 版本管理

- **FR-009**: 系統必須在配方提交時自動產生版本號，遵循以下規則：
  - **版本編號格式**：v1, v2, v3, v4...（遞增數字）
  - 首次建立配方第一個版本時，版本號為 v1
  - 基於現有版本建立新版本時，版本號自動遞增（例如 v1 → v2 → v3）
  - 每個版本必須有「版本標籤」欄位，用於描述版本特色（例如：傳統版、低糖版、速煮版）

- **FR-010**: 系統必須提供「新增版本」功能，位於版本歷史頁面：
  - 點擊「新增版本」按鈕，開啟配方建立表單
  - 版本號自動遞增（系統自動填入下一個版本號）
  - 可選擇是否基於現有版本複製資料（預設不複製，讓使用者從空白表單開始）

- **FR-011**: 系統必須提供「編輯版本」功能，位於版本歷史頁面的操作欄：
  - 點擊「✏ 編輯」按鈕，開啟該版本的編輯表單
  - 僅能編輯當前版本的資料，無法修改版本號

- **FR-012**: 系統必須提供「複製版本」功能，位於版本歷史頁面的操作欄：
  - 點擊「📋 複製」按鈕，複製該版本的所有資料
  - 建立新版本，版本號自動遞增
  - 使用者可在新版本表單中修改內容後儲存

- **FR-013**: 系統必須保留所有配方的歷史版本，不得刪除或覆蓋

- **FR-014**: 系統必須提供**版本歷史頁面**，顯示同一配方的所有版本：
  - 頁面標題顯示：`{配方名稱} - 版本管理`
  - 顯示版本統計：`共 {n} 個版本`
  - 提供搜尋功能：可搜尋版本名稱、研發目的
  - 提供篩選功能：依狀態、日期範圍篩選
  - 提供匯出功能：匯出版本清單為 Excel
  - 表格欄位：版本號、版本名稱、建立日期、研發目的、樣品數、PH值、糖度、操作按鈕

- **FR-015**: 系統必須在版本歷史表格中提供以下操作按鈕：
  - **👁 查看**：查看該版本的完整詳情（唯讀模式）
  - **✏ 編輯**：編輯該版本的資料
  - **📋 複製**：基於該版本建立新版本
  - **🗑 刪除**：刪除該版本（需彈出確認 Modal）

- **FR-016**: 系統必須允許使用者查看任一版本的完整資訊（配方詳情頁面），包含：
  - 左側快速資訊卡片：建立日期、樣品數量、PH值、Brix糖度
  - 右側主要內容：研發資訊、配方項目表格、穀物專用資訊、注意事項
  - 頂部操作按鈕：送樣、編輯

- **FR-017**: 系統必須確保所有下游文件（規格表/品規書/確認單）隨著版本號更新

#### 配方列表與查詢

- **FR-018**: 系統必須提供**配方列表頁面**，以表格形式顯示所有配方主檔（不是版本），包含以下欄位：
  - **全選勾選框**：批次操作用（支援全選功能）
  - **編號**：配方編號（例如：#0001, #0002），顯示為灰色徽章樣式（bg-gray-100 text-gray-700 font-mono）
  - **配方名稱**：主標題（配方名稱，font-semibold）+ 副標題（說明文字，text-xs text-gray-500）+ 主圖縮圖（選填，10x10 圓角，ring-1 ring-gray-200）
  - **版本數**：顯示版本總數（例如：「3 個版本」），點擊進入版本歷史頁面，使用漸層背景（from-blue-50 to-indigo-50）搭配標籤圖標
  - **最新版本**：最新版本的版本號徽章（例如：v1, v2, v3），使用 version-badge 元件
  - **最後更新**：配方最後更新日期（YYYY-MM-DD 格式）
  - **操作**：圖示按鈕（檢視、版本、編輯、刪除），每個圖示使用語意化顏色（藍色、綠色、橘色、紅色）

- **FR-019**: 系統必須在配方列表頂部提供以下操作功能：
  - **搜尋欄位**：搜尋配方名稱（關鍵字搜尋，支援模糊比對）
  - **篩選按鈕**：開啟篩選面板
  - **排序按鈕**：切換排序方式
  - **顯示筆數**：顯示當前頁面範圍（例如：顯示 01-10 筆）
  - **新增配方按鈕**：開啟新增配方表單

- **FR-020**: 系統必須在配方列表的操作欄提供以下圖示按鈕：
  - **👁 檢視**（藍色，blue-600）：查看配方詳情，使用眼睛圖標（Heroicons: eye），hover 時顯示藍色圓形背景（hover:bg-blue-50）
  - **🕐 版本**（綠色，green-600）：進入該配方的版本歷史頁面，使用時鐘圖標（Heroicons: clock），hover 時顯示綠色圓形背景（hover:bg-green-50）
  - **✏ 編輯**（橘色，orange-600）：編輯配方主檔資訊，使用鉛筆圖標（Heroicons: pencil），hover 時顯示橘色圓形背景（hover:bg-orange-50）
  - **🗑 刪除**（紅色，red-600）：刪除該配方（需彈出確認 Modal），使用垃圾桶圖標（Heroicons: trash），hover 時顯示紅色圓形背景（hover:bg-red-50）
  - 所有圖示按鈕尺寸統一為 8x8（w-8 h-8），圖標本身為 5x5（w-5 h-5），圓角 rounded-lg，過渡動畫 transition-all duration-200

- **FR-21**: 系統必須支援配方列表的排序功能，可依建立日期（升序/降序）、版本號、狀態排序

- **FR-022**: 系統必須在配方列表採用分頁顯示，每頁顯示 10-20 筆資料，提供頁碼導航

- **FR-022-1**: 系統必須為**配方列表表格**（recipe-list-table）提供以下視覺設計特性：
  - **表格標題列**：漸層背景（bg-gradient-to-r from-gray-50 to-gray-100/50）
  - **表格列 Hover 效果**：漸層效果（hover:bg-gradient-to-r hover:from-indigo-50/30 hover:to-purple-50/20），過渡動畫 transition-all duration-200
  - **列間分隔線**：使用柔和的 divide-gray-100（而非 gray-200）
  - **編號欄位**：徽章樣式（inline-flex items-center px-2.5 py-0.5 rounded-md bg-gray-100 text-gray-700 font-mono text-xs font-semibold）
  - **配方名稱**：主標題使用 font-semibold text-gray-900，說明文字使用 text-xs text-gray-500，圖片加入細框 ring-1 ring-gray-200
  - **版本數欄位**：漸層背景（bg-gradient-to-br from-blue-50 to-indigo-50），hover 時加深（hover:from-blue-100 hover:to-indigo-100），包含藍色標籤圖標（w-4 h-4 text-blue-600）和文字（text-blue-700 font-semibold text-xs），過渡動畫 transition-all duration-200
  - **操作圖示**：8x8 圓形按鈕（w-8 h-8 rounded-lg），圖標 5x5，語意化顏色（藍/綠/橘/紅），hover 時顯示對應顏色的淡色背景（例如 hover:bg-blue-50），過渡動畫 transition-all duration-200
  - **對齊方式**：編號、版本數、最新版本、最後更新、操作欄位均為置中對齊（text-center），配方名稱為靠左對齊（text-left）
  - **勾選框**：置中對齊（text-center align-middle），使用 Tailwind 預設樣式（rounded border-gray-300 text-indigo-600 focus:ring-indigo-600 size-4）

#### 審核流程

- **FR-023**: 系統必須提供主管專用的審核介面，顯示所有待審核配方
- **FR-024**: 系統必須在配方詳情頁面顯示完整資訊，包含：
  - 所有表單欄位（名稱、日期、版本號、目的、條件、樣品數、項目清單、注意事項、洗豆時間、洗豆水量、每包投料量、膨脹率等）
  - 照片（原始大小或可放大檢視）
  - 項目清單（完整表格，包含項目名稱、百分比、克數）
  - 版本號和來源配方編號
  - 建立人和建立時間
  - 審核歷程（如有）

- **FR-025**: 系統必須提供「核准」和「退回」操作按鈕，僅主管角色可見
- **FR-026**: 系統必須在主管點擊「核准」或「退回」時，彈出確認視窗並要求填寫審核意見（必填，最多 200 字元）
- **FR-027**: 系統必須在審核完成後，更新配方狀態：
  - 核准：狀態更新為「已核准」
  - 退回：狀態更新為「已退回」

- **FR-028**: 系統必須記錄審核歷程，包含：
  - 審核人（主管姓名）
  - 審核時間（精確到秒）
  - 審核動作（核准/退回）
  - 審核意見（完整文字）

- **FR-029**: 系統必須在配方被退回時，發送通知給建立該配方的研發人員（站內通知或電子郵件）
- **FR-030**: 系統必須限制審核權限，僅主管角色可執行審核操作，研發人員無法看到審核按鈕

#### 介面與互動

- **FR-031**: 系統必須提供響應式介面，支援桌面（1920x1080 以上）和平板（768x1024 以上）裝置使用

- **FR-032**: 系統必須在使用者執行關鍵操作時提供確認提示，包含：
  - 提交審核：「確定要提交此配方進行審核嗎？」
  - 核准配方：「確定要核准此配方嗎？請填寫審核意見。」
  - 退回配方：「確定要退回此配方嗎？請說明退回原因。」

- **FR-033**: 系統必須在操作成功/失敗時提供明確的視覺回饋：
  - 成功：綠色漸層訊息框（from-green-50 to-emerald-50），左側綠色邊框，圖標在圓角背景中，從右側滑入動畫，顯示 3 秒後自動消失
  - 失敗：紅色漸層訊息框（from-red-50 to-pink-50），左側紅色邊框，圖標在圓角背景中，需使用者手動關閉
  - 警告：黃色漸層訊息框（from-yellow-50 to-orange-50），左側黃色邊框
  - 資訊：藍色漸層訊息框（from-blue-50 to-indigo-50），左側藍色邊框

- **FR-034**: 系統必須提供麵包屑導航，顯示使用者目前位置（例如：研發模組 > 配方單管理），包含首頁圖標

- **FR-035**: 系統必須支援鍵盤導航（Tab 鍵切換欄位，Enter 鍵提交表單）

- **FR-036**: 系統必須符合 WCAG 2.1 AA 無障礙標準，包含：
  - 所有表單欄位有明確的 label
  - 顏色對比度符合標準（至少 4.5:1）
  - 錯誤訊息可被螢幕閱讀器讀取

- **FR-037**: 系統必須提供草稿儲存功能，使用者可暫存未完成的配方（儲存在瀏覽器本地或伺服器）

- **FR-038**: 系統必須在使用者離開未儲存的表單頁面時，彈出警告提示：「您有未儲存的變更，確定要離開嗎？」

- **FR-039**: 系統必須提供「返回頂部」按鈕（scroll-to-top），具備以下特性：
  - 固定在頁面右下角（bottom-8 right-8）
  - 當使用者滾動超過 300px 時自動淡入顯示
  - 圓形按鈕（14x14），紫色漸層背景（from-indigo-600 to-purple-600）
  - Hover 時放大 10%、陰影加深、箭頭向上移動
  - 點擊後平滑滾動回頁面頂部
  - Hover 時顯示「返回頂部」提示文字

#### 視覺設計系統

- **FR-040**: 系統必須採用一致的現代化設計語言，包含：
  - **顏色系統**：以 Indigo（藍紫）為主色，輔以 Purple（紫）、Green（綠）、Red（紅）、Blue（藍）、Amber（琥珀）、Emerald（翠綠）等色彩
  - **漸層使用**：主要元件使用漸層背景提升視覺層次
  - **圓角規範**：卡片使用 rounded-xl（12px），按鈕和輸入框使用 rounded-lg（8px）
  - **陰影系統**：卡片使用 shadow-md，hover 時升級為 shadow-lg
  - **間距系統**：區塊間距使用 space-y-8，內部間距使用 px-6 py-6

- **FR-041**: 系統必須在 Page Header 區域提供以下設計特性：
  - 漸層背景（from-white via-indigo-50/30 to-purple-50/30）
  - 左側顯示大型漸層圖標（12x12，from-indigo-500 to-purple-600）
  - 標題字體大小為 text-4xl，bold，tracking-tight
  - 麵包屑導航包含首頁圖標和箭頭分隔符
  - 右側操作按鈕使用漸層背景和陰影效果

- **FR-042**: 系統必須為每個表單區塊提供以下視覺特性：
  - 白色卡片背景（bg-white），rounded-xl 圓角
  - 左側 4px 彩色邊框（border-l-4），每個區塊使用不同顏色：
    - 配方主檔資訊：Indigo（border-indigo-500）
    - 版本資訊：Purple（border-purple-500）
    - 測量數據：Blue（border-blue-500）
    - 配方項目：Rose（border-rose-500），附加「必填」徽章
    - 穀物專用資訊：Amber（border-amber-500）
    - 照片與備註：Emerald（border-emerald-500）
  - 標題區域包含漸層圖標（10x10）和標題文字
  - 標題區域淡色漸層背景（例如：from-indigo-50/50 to-transparent）
  - Hover 時陰影加深（shadow-md → shadow-lg）
  - 過渡動畫（transition-shadow duration-200）

- **FR-043**: 系統必須為所有表單輸入欄位提供以下互動特性：
  - 圓角：rounded-lg（8px）
  - 邊框：ring-1 ring-inset ring-gray-300
  - Padding：px-3 py-2.5
  - Focus 狀態：ring-2 ring-indigo-500，陰影加深（shadow-md）
  - 過渡動畫：transition-all duration-200
  - Placeholder 顏色：text-gray-400
  - 文字大小：text-sm

- **FR-044**: 系統必須為按鈕提供以下設計特性：
  - **Primary 按鈕**：紫色漸層（from-indigo-600 to-indigo-700），hover 時加深（from-indigo-700 to-indigo-800），shadow-md
  - **Secondary 按鈕**：白色背景，灰色邊框（ring-1 ring-gray-300），hover 時背景變灰（bg-gray-50）
  - **Danger 按鈕**：紅色漸層（from-red-600 to-red-700），hover 時加深
  - 點擊時縮小 5%（active:scale-95）
  - Focus 時顯示 ring-2 光圈
  - 過渡動畫：transition-all duration-200

- **FR-045**: 系統必須為配方項目表格（item-table）提供以下視覺特性：
  - 斑馬紋效果：偶數行白色，奇數行淡灰（bg-gray-50/50）
  - Hover 效果：淡紫色背景（hover:bg-indigo-50/50），過渡動畫
  - 行號顯示：紫色圓形徽章（bg-indigo-100 text-indigo-700）
  - 表頭漸層背景（from-gray-50 to-gray-100/50）
  - 刪除按鈕：紅色文字，hover 時顯示淡紅背景（hover:bg-red-50）
  - 邊框：rounded-lg，border border-gray-200

- **FR-046**: 系統必須為圖片上傳區域提供以下動畫和視覺效果：
  - 虛線邊框（border-2 border-dashed border-gray-300）
  - 漸層背景（from-gray-50 to-indigo-50/20）
  - Hover 時邊框變紫色（hover:border-indigo-400），背景加深
  - 圖標浮動動畫：上下浮動 10px，3 秒循環，hover 時加速至 2 秒
  - 中央漸層圖標按鈕（from-indigo-500 to-purple-600）
  - 點狀裝飾背景圖案（opacity-5）
  - 圓角：rounded-xl
  - 預覽圖片包含紫色光暈效果（漸層 blur 背景）
  - Hover 時預覽圖片放大 5%（scale-105）

#### 元件化設計

- **FR-047**: 系統必須採用元件化設計架構，將可重複使用的 UI 元素抽取為獨立元件，包含：
  - **page-header**：頁面標題元件，支援自訂標題、副標題、麵包屑、操作按鈕
  - **button**：按鈕元件，支援 primary/secondary/danger 變體和 xs/sm/md/lg/xl 尺寸
  - **alert**：通知訊息元件，支援 success/error/warning/info 類型
  - **form-field**：表單輸入欄位元件，支援 label、驗證、錯誤提示、前綴/後綴
  - **textarea-field**：多行文字輸入元件，支援字數統計
  - **select-field**：下拉選單元件，整合 @tailwindplus/elements
  - **image-upload**：圖片上傳元件，支援拖放、預覽、動畫效果
  - **item-table**：配方項目表格元件，支援動態新增/刪除、百分比驗證
  - **scroll-to-top**：返回頂部按鈕元件，支援自訂觸發閾值和位置

- **FR-048**: 所有元件必須支援參數化配置，遵循 Blade 元件規範，使用 `@props` 定義可接受的參數

### Key Entities

系統採用二層式資料結構：**配方主檔 (Recipe) → 版本 (Version)**

- **配方主檔 (Recipe)**: 代表產品配方的基本識別資訊，包含以下屬性：
  - **配方 ID**（自動產生，主鍵）
  - **配方編號**（顯示用編號，格式：#0001, #0002...）
  - **配方名稱**（例如：紅豆湯、糙米粥）
  - **配方說明**（選填，說明配方用途）
  - **配方主圖 URL**（選填，主要照片）
  - **建立人**（關聯到使用者）
  - **建立時間**（配方主檔建立時間）
  - **最新版本**（關聯到最新的版本 ID，用於快速查詢）
  - **版本列表**（關聯到多個版本實體）

- **版本 (Version)**: 代表配方的特定版本，包含完整配方內容，包含以下屬性：
  - **版本 ID**（自動產生，主鍵）
  - **配方 ID**（關聯到配方主檔）
  - **版本名稱**（格式：v1, v2, v3...）
  - **版本標籤**（例如：傳統版、低糖版、速煮版）
  - **建立日期**（此版本建立日期）
  - **研發目的**（說明此版本的研發目的）
  - **條件說明**（記錄殺菌條件、客戶需求等）
  - **測量數據**：
    - PH 值（數值，範圍 0-14）
    - Brix 糖度（數值，單位：°Bx）
    - 樣品數（數值）
    - 樣品單位（罐/杯/袋/碗）
  - **配方項目清單**（關聯到多個項目實體）
  - **穀物專用資訊**（選填）：
    - 洗豆時間（數值，單位：分鐘）
    - 洗豆水量（數值，單位：ml）
    - 每包投料量（數值，單位：g）
    - 膨脹率（數值，倍數）
  - **照片 URLs**（選填，支援多張照片）
  - **注意事項**（選填，多行文字）
  - **狀態**（待審核/已核准/已退回/已歸檔）
  - **建立人**（關聯到使用者）
  - **建立時間**（版本建立時間）
  - **審核歷程**（關聯到多個審核記錄）

- **項目 (Item)**: 代表配方版本中的單一項目，包含以下屬性：
  - **項目 ID**（自動產生，主鍵）
  - **版本 ID**（關聯到版本）
  - **項目名稱**（例如：紅豆、糖、水）
  - **百分比**（數值，支援小數點，單位：%）
  - **克數**（數值，支援小數點，單位：g）
  - **順序**（在項目清單中的排序）

- **審核記錄 (Approval Record)**: 記錄版本的審核歷程，包含以下屬性：
  - **審核 ID**（自動產生，主鍵）
  - **版本 ID**（關聯到版本）
  - **審核人**（關聯到使用者，主管角色）
  - **審核時間**（時間戳記）
  - **審核動作**（核准/退回）
  - **審核意見**（文字，最多 200 字元）

- **使用者 (User)**: 系統使用者，包含以下屬性：
  - 使用者 ID
  - 姓名
  - 角色（研發人員/主管）
  - 電子郵件（用於通知）

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 研發人員能在 3 分鐘內完成新配方的建立和提交（包含填寫所有必填欄位和上傳照片）
- **SC-002**: 使用「編製新版本」功能建立配方，比從頭建立節省 60% 以上的時間
- **SC-003**: 使用者能在 10 秒內透過篩選功能找到目標配方（在 100+ 配方的資料庫中）
- **SC-004**: 主管能在 2 分鐘內完成單一配方的審核流程（查看詳情、填寫意見、提交審核）
- **SC-005**: 介面在桌面和平板裝置上的可用性測試通過率達 90% 以上
- **SC-006**: 配方列表頁面載入時間低於 2 秒（包含 100 筆配方資料）
- **SC-007**: 配方詳情頁面載入時間低於 1.5 秒（包含照片）
- **SC-008**: 使用者首次使用系統完成配方建立的成功率達 85% 以上（無需額外培訓或說明文件）
- **SC-009**: 系統能正確保留和顯示至少 10 個歷史版本的配方，無資料遺失或錯誤
- **SC-010**: 配方篩選結果的準確率達 100%（符合所選條件，無漏失或誤判）
- **SC-011**: 所有關鍵操作（提交、核准、退回）的使用者錯誤率低於 5%
- **SC-012**: 照片上傳成功率達 95% 以上（在正常網路環境下）
- **SC-013**: 表單欄位驗證即時回饋時間低於 300ms（使用者輸入後立即顯示錯誤提示）

## Assumptions *(documentation)*

### UI/UX 假設

- 假設使用者主要使用桌面或平板裝置，手機版本不在目前範圍內
- 假設配方表單採用單頁表單設計，所有欄位在同一頁面顯示，不使用多步驟精靈
- 假設原料清單使用動態表格形式，每行一個原料，支援即時新增/刪除行
- 假設照片上傳採用拖放或點擊選擇方式，上傳後顯示縮圖預覽
- 假設系統提供即時驗證（邊輸入邊驗證），而非僅在提交時驗證
- 假設版本號顯示格式統一為「v + 數字」（例如 v1, v2, v3）
- 假設配方列表頁面顯示配方主檔，點擊後進入版本歷史頁面查看所有版本

### 業務邏輯假設

- 假設同一配方可以有多個版本同時存在，每個版本有獨立的狀態
- 假設版本一旦建立後可以編輯，直到狀態變更為「已核准」或「已歸檔」
- 假設審核意見為必填欄位（核准和退回都需要填寫）
- 假設配方歷史版本永久保留，無自動刪除機制
- 假設通知機制採用站內通知（彈出訊息或通知列表），不包含電子郵件或簡訊
- 假設「來源配方編號」欄位選擇後，系統自動填入資訊但允許使用者修改
- 假設版本號達到上限（例如 Z99）時，系統提示使用者聯絡管理員處理

### 欄位邏輯假設

- 假設「配方主檔資訊」（配方名稱、配方說明、配方主圖）在首次建立時填寫，後續建立新版本時不再修改
- 假設「版本資訊」（版本名稱、版本標籤、建立日期、研發目的、條件說明）每個版本獨立填寫
- 假設「PH 值」欄位為數字輸入，範圍 0-14，支援小數點（例如：6.5）
- 假設「Brix 糖度」欄位為數字輸入，單位為 °Bx，支援小數點（例如：15.2）
- 假設「樣品數」欄位為數字輸入，單位透過下拉選單選擇（罐/杯/袋/碗）
- 假設「洗豆時間」、「洗豆水量」、「每包投料量」、「膨脹率」為純數字輸入，單位在欄位標籤中說明
- 假設「項目清單」中的「百分比」和「克數」支援小數點（例如 25.5%, 150.25g）
- 假設「日期」欄位預設為今日，但允許使用者選擇其他日期（不限制未來或過去日期）
- 假設「條件說明」為單一多行文字輸入欄位，取代原本的「殼種名稱」和「客戶需求」兩個子欄位
- 假設「研發目的」和「注意事項」為多行文字輸入，支援換行
- 假設「項目清單」的百分比總和建議為 100%，但不強制（系統僅顯示黃色警告提示）
- 假設所有數值欄位（PH、Brix、樣品數、項目百分比、克數、穀物資訊）都是選填，非必填

### 技術假設

- 假設系統支援現代瀏覽器（Chrome, Firefox, Safari, Edge 最新兩個版本）
- 假設圖片上傳限制為單張 5MB，格式支援 JPG/PNG
- 假設配方列表採用分頁顯示，每頁顯示 20 筆資料
- 假設篩選功能採用前端即時過濾（資料量小於 1000 筆時）或後端 API 查詢（資料量大於 1000 筆時）
- 假設草稿儲存功能使用瀏覽器 localStorage（容量限制 5MB）或伺服器端儲存

### 權限假設

- 假設研發人員可以建立、編輯自己的配方（待審核或已退回狀態），查看所有配方
- 假設主管可以查看、審核所有配方，但不能直接建立或編輯配方
- 假設系統使用既有的身分驗證機制，不需要額外的登入系統
- 假設使用者角色（研發人員/主管）在登入時已確定，無需在介面中切換
