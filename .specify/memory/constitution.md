<!--
Sync Impact Report:
Version: 0.0.0 → 1.0.0
Modified Principles: N/A (initial creation)
Added Sections:
  - 核心原則 (5 principles: 程式碼品質、測試驅動開發、使用者體驗一致性、效能要求、可維護性)
  - 技術約束
  - 開發流程
  - 治理規範
Removed Sections: N/A
Templates Requiring Updates:
  ✅ plan-template.md - Constitution Check section references this file
  ✅ spec-template.md - Requirements align with quality principles
  ✅ tasks-template.md - Task structure supports test-first approach
Follow-up TODOs: None
-->

# Luscious Food 專案憲章

## 核心原則

### I. 程式碼品質原則 (Code Quality First)

所有程式碼必須遵循以下品質標準：

- **單一職責原則 (SRP)**: 每個類別、方法只負責一件事情，避免過度耦合
- **可重用性優先**: 在撰寫新程式碼前，必須先檢查是否已有相似功能可以重用
- **程式碼分析報告**: 每次重大變更都需進行耦合性分析和職責檢查，並產出分析報告
- **Laravel 最佳實踐**: 遵循 Laravel 官方規範和社群最佳實踐
- **程式碼風格**: 使用 Laravel Pint 確保程式碼風格一致性

**理由**: 高品質程式碼能降低維護成本、減少 bug、提升團隊協作效率

### II. 測試驅動開發 (Test-Driven Development - NON-NEGOTIABLE)

測試是不可妥協的基本要求：

- **測試優先**: 所有新功能必須先撰寫測試，測試失敗後才能開始實作（Red-Green-Refactor）
- **測試層級**:
  - **單元測試 (Unit Tests)**: 測試單一類別或方法的邏輯
  - **功能測試 (Feature Tests)**: 測試完整的使用者情境和 HTTP 請求流程
  - **整合測試 (Integration Tests)**: 測試服務間的互動和資料庫操作
- **測試覆蓋率**: 核心業務邏輯必須達到 80% 以上的測試覆蓋率
- **持續整合**: 所有測試必須在 CI/CD 流程中自動執行並通過

**理由**: TDD 確保程式碼可靠性、可測試性，並作為活文件記錄系統行為

### III. 使用者體驗一致性 (UX Consistency)

提供一致且直覺的使用者體驗：

- **介面一致性**: UI 元件、互動模式、視覺風格必須保持一致
- **回應時間標準**:
  - 頁面載入時間 < 2 秒（初次載入）
  - 互動回應時間 < 300ms
  - API 回應時間 p95 < 500ms
- **錯誤處理**: 提供清晰、友善的錯誤訊息，避免技術術語
- **無障礙設計**: 遵循 WCAG 2.1 AA 級標準
- **多裝置支援**: 確保在桌面、平板、手機上都能正常運作

**理由**: 一致的 UX 提升使用者滿意度、降低學習成本、減少支援請求

### IV. 效能要求 (Performance Requirements)

系統必須滿足以下效能指標：

- **資料庫查詢**:
  - 避免 N+1 查詢問題，使用 Eager Loading
  - 複雜查詢必須加上適當索引
  - 查詢時間 p95 < 100ms
- **快取策略**:
  - 靜態內容必須使用瀏覽器快取
  - 頻繁查詢的資料必須使用 Redis/Memcached
  - 快取失效策略必須明確定義
- **資源使用**:
  - 記憶體使用量 < 512MB per process
  - CPU 使用率 < 70% under normal load
- **併發處理**: 支援至少 100 concurrent users without degradation
- **監控機制**: 使用 Laravel Telescope/Debugbar 進行效能分析

**理由**: 良好的效能直接影響使用者體驗和系統可擴展性

### V. 可維護性與文件化 (Maintainability & Documentation)

確保程式碼長期可維護：

- **程式碼可讀性**:
  - 使用有意義的變數名稱和函式名稱
  - 複雜邏輯必須加上註解說明
  - 避免過長的方法（超過 50 行需重構）
- **文件要求**:
  - API 端點必須使用 OpenAPI/Swagger 文件化
  - 重要業務邏輯必須在程式碼中加上 PHPDoc 註解
  - 新功能必須更新相關的 README 或使用者文件
- **版本控制**:
  - Commit message 必須清楚描述變更內容和原因
  - 重大變更必須在 CHANGELOG 中記錄
- **依賴管理**: 定期更新依賴套件，避免使用過時或有安全漏洞的版本

**理由**: 良好的可維護性降低技術債、提升開發效率、便於新成員加入

## 技術約束

### 技術棧標準

- **語言版本**: PHP ^8.2
- **框架**: Laravel ^12.0
- **測試工具**: PHPUnit ^11.5
- **程式碼風格**: Laravel Pint ^1.24
- **資料庫**: 優先使用 PostgreSQL 或 MySQL，開發環境可用 SQLite
- **前端**: 使用 Vite 建置，支援現代 JavaScript/TypeScript

### 安全要求

- **OWASP Top 10**: 必須防範常見的安全漏洞（SQL Injection, XSS, CSRF 等）
- **認證授權**: 使用 Laravel 內建的認證系統或 Laravel Sanctum
- **資料驗證**: 所有使用者輸入必須經過驗證和淨化
- **敏感資料**: 使用環境變數管理敏感資訊，絕不 commit .env 檔案
- **依賴檢查**: 定期執行安全性掃描（composer audit）

### 部署要求

- **環境分離**: Development, Staging, Production 環境必須明確分離
- **CI/CD**: 使用自動化部署流程，確保測試通過後才能部署
- **備份機制**: 資料庫必須有定期備份和復原計畫
- **日誌記錄**: 所有錯誤和重要操作必須記錄在日誌中

## 開發流程

### 功能開發流程

1. **分析需求**: 充分理解需求，有不清楚的地方必須提問，不可猜測
2. **程式碼分析**:
   - 檢查現有程式碼是否有可重用的功能
   - 分析程式碼耦合性
   - 確認是否符合單一職責原則
   - 產出分析報告
3. **撰寫測試**: 先撰寫測試案例，確保測試失敗
4. **實作功能**: 撰寫最小可行的程式碼讓測試通過
5. **重構**: 在測試保護下進行程式碼優化
6. **程式碼審查**: 由團隊成員審查程式碼品質和設計
7. **文件更新**: 更新相關文件和 API 說明

### Code Review 檢查清單

- [ ] 是否遵循單一職責原則？
- [ ] 是否檢查過可重用的程式碼？
- [ ] 是否有足夠的測試覆蓋率？
- [ ] 是否有潛在的安全漏洞？
- [ ] 是否有效能問題（N+1, 缺少索引等）？
- [ ] 程式碼是否易讀易維護？
- [ ] 是否更新了相關文件？
- [ ] Commit message 是否清楚描述變更？

### 品質門檻 (Quality Gates)

在以下階段必須通過品質檢查：

- **Commit**: 本地測試必須通過，程式碼風格檢查通過
- **Pull Request**: 所有 CI 測試通過，Code Review 核准
- **Merge to Main**: 整合測試通過，效能測試通過
- **部署到 Production**: Staging 環境驗證通過，備份確認完成

## 治理規範

### 憲章修訂程序

1. **提議階段**: 任何團隊成員可以提議修訂憲章
2. **討論階段**: 團隊討論修訂的必要性和影響範圍
3. **核准階段**: 需要團隊多數成員同意（> 50%）
4. **遷移計畫**: 如修訂影響現有程式碼，需制定遷移計畫
5. **版本更新**: 更新憲章版本號並記錄變更
6. **文件同步**: 更新所有相關的模板和指引文件

### 版本管理政策

憲章版本遵循語義化版本 (Semantic Versioning):

- **MAJOR (X.0.0)**: 移除或重新定義核心原則，向後不相容
- **MINOR (0.X.0)**: 新增原則或大幅擴充指引內容
- **PATCH (0.0.X)**: 文字修正、澄清說明、非語義上的調整

### 合規性審查

- **每月檢查**: Tech Lead 每月審查團隊是否遵循憲章原則
- **季度評估**: 每季評估憲章的有效性和適用性
- **違規處理**: 發現違反憲章的程式碼必須及時修正
- **持續改進**: 根據實際執行情況調整憲章內容

### 開發指引參考

日常開發時，請參考以下文件：

- **專案指引**: `/Claude.md` - 包含分析問題、程式碼檢查、中文回答等操作指引
- **規範模板**: `.specify/templates/` - 包含 spec、plan、tasks 等標準模板
- **技術文件**: `README.md` - 專案概述和快速開始指南

**版本**: 1.0.0 | **核准日期**: 2025-11-06 | **最後修訂**: 2025-11-06
